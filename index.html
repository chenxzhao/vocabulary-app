<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>多列表单词发音播放器</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- PWA配置 -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3B82F6">
  <link rel="apple-touch-icon" href="icon-192x192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  
  <!-- Tailwind配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            accent: '#EF4444',
            dark: '#1E293B',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.1), 0 8px 10px -6px rgba(59, 130, 246, 0.1);
      }
      .btn-hover {
        @apply transition-all duration-300 hover:scale-105 active:scale-95;
      }
      .loop-active {
        animation: pulse 2s infinite;
      }
      .modal-backdrop {
        backdrop-filter: blur(4px);
      }
      .save-indicator {
        animation: fadeInOut 2s;
      }
      .list-item-active {
        @apply bg-primary/10 border-primary font-medium;
      }
      .play-time-btn.active {
        @apply bg-primary text-white border-primary;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.8; }
      }
      @keyframes fadeInOut {
        0% { opacity: 0; }
        50% { opacity: 1; }
        100% { opacity: 0; }
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4 font-sans">
  <div class="w-full max-w-md bg-white rounded-2xl p-8 card-shadow">
    <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-center text-dark mb-8">单词发音练习</h1>
    
    <!-- 列表和播放次数设置区 -->
    <div class="mb-6 flex flex-col gap-2">
      <div class="flex justify-between items-center">
        <div class="text-sm text-gray-500">当前列表: <span id="current-list-name" class="font-medium text-primary">默认列表</span></div>
        <button id="list-manager-btn" class="text-sm text-primary hover:text-primary/80 flex items-center gap-1">
          <i class="fa fa-list"></i>
          <span>列表管理</span>
        </button>
      </div>
      <div class="text-sm text-gray-500">
        默认播放次数: <span id="default-times-display" class="font-medium text-primary">3次</span>
        <button id="change-default-times" class="ml-1 text-xs text-primary hover:underline">修改</button>
      </div>
    </div>
    
    <!-- 单词显示区 -->
    <div class="mb-10 text-center">
      <div class="text-gray-500 mb-2 text-lg">当前单词</div>
      <div id="word-display" class="text-[clamp(2rem,5vw,3rem)] font-bold text-primary transition-all duration-500 transform">apple</div>
      <div id="phonetic-display" class="mt-2 text-[clamp(1rem,2vw,1.2rem)] text-gray-500">/ˈæpl/</div>
      <div id="meaning-display" class="mt-3 text-[clamp(1.2rem,3vw,1.5rem)] text-gray-600 italic">苹果</div>
    </div>
    
    <!-- 控制按钮区 -->
    <div class="flex flex-col gap-4">
      <button id="play-btn" class="bg-primary hover:bg-primary/90 text-white py-4 px-6 rounded-xl flex items-center justify-center gap-2 btn-hover">
        <i class="fa fa-volume-up text-xl"></i>
        <span>播放发音</span>
      </button>
      
      <button id="play-default-btn" class="bg-orange-500 hover:bg-orange-600 text-white py-3 px-6 rounded-xl flex items-center justify-center gap-2 btn-hover">
        <i class="fa fa-repeat text-xl"></i>
        <span>按默认次数播放</span>
      </button>
      
      <button id="pause-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white py-3 px-6 rounded-xl flex items-center justify-center gap-2 btn-hover hidden">
        <i class="fa fa-pause text-xl"></i>
        <span>暂停播放</span>
      </button>
      
      <button id="import-btn" class="bg-purple-600 hover:bg-purple-700 text-white py-3 px-6 rounded-xl flex items-center justify-center gap-2 btn-hover">
        <i class="fa fa-upload text-xl"></i>
        <span>导入单词到当前列表</span>
      </button>

      <button id="reset-btn" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-6 rounded-xl flex items-center justify-center gap-2 btn-hover text-sm">
        <i class="fa fa-refresh"></i>
        <span>清空当前列表</span>
      </button>
      
      <button id="prev-btn" class="bg-blue-700 hover:bg-blue-800 text-white py-4 px-6 rounded-xl flex items-center justify-center gap-2 btn-hover">
        <i class="fa fa-arrow-left text-xl"></i>
        <span>上一个单词</span>
      </button>
      
      <button id="next-btn" class="bg-secondary hover:bg-secondary/90 text-white py-4 px-6 rounded-xl flex items-center justify-center gap-2 btn-hover">
        <i class="fa fa-arrow-right text-xl"></i>
        <span>下一个单词</span>
      </button>
    </div>
    
    <!-- 状态区 -->
    <div class="mt-8 text-center text-gray-500">
      <div id="status" class="mb-2 text-sm">状态：单次播放模式</div>
      <div id="progress">1/10</div>
      <div id="save-hint" class="mt-1 text-xs text-green-500 hidden save-indicator">操作已保存</div>
    </div>
  </div>
  
  <!-- 导入弹窗 -->
  <div id="import-modal" class="fixed inset-0 bg-black/50 modal-backdrop flex items-center justify-center p-4 z-50 hidden">
    <div class="w-full max-w-md bg-white rounded-2xl p-6 card-shadow transform transition-all">
      <h2 class="text-xl font-bold text-dark mb-4">导入单词到当前列表</h2>
      <p class="text-gray-500 text-sm mb-4">请输入单词，每行一个（格式：英文 音标 中文 或 英文:音标:中文）</p>
      <textarea 
        id="word-input" 
        class="w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all resize-none"
        placeholder="例如：
apple /ˈæpl/ 苹果
banana:/bəˈnɑːnə/:香蕉
computer /kəmˈpjuːtə/ 电脑
..."
      ></textarea>
      <div class="mt-4 flex gap-3">
        <button id="cancel-import" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-4 rounded-xl btn-hover">取消</button>
        <button id="confirm-import" class="flex-1 bg-primary hover:bg-primary/90 text-white py-3 px-4 rounded-xl btn-hover">确认导入</button>
      </div>
    </div>
  </div>

  <!-- 列表管理弹窗 -->
  <div id="list-manager-modal" class="fixed inset-0 bg-black/50 modal-backdrop flex items-center justify-center p-4 z-50 hidden">
    <div class="w-full max-w-md bg-white rounded-2xl p-6 card-shadow transform transition-all">
      <h2 class="text-xl font-bold text-dark mb-4">单词列表管理</h2>
      <div class="flex gap-2 mb-4">
        <input 
          type="text" 
          id="new-list-name" 
          placeholder="输入新列表名称" 
          class="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
        >
        <button id="create-list-btn" class="bg-primary hover:bg-primary/90 text-white py-2 px-4 rounded-lg btn-hover">
          <i class="fa fa-plus"></i>
        </button>
      </div>
      <div id="lists-container" class="max-h-60 overflow-y-auto mb-4"></div>
      <div class="flex gap-3">
        <button id="close-list-manager" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-4 rounded-xl btn-hover">关闭</button>
        <button id="delete-list-btn" class="flex-1 bg-accent hover:bg-accent/90 text-white py-3 px-4 rounded-xl btn-hover">
          <i class="fa fa-trash"></i>
          <span>删除选中列表</span>
        </button>
      </div>
    </div>
  </div>

  <!-- 播放次数设置弹窗 -->
  <div id="play-times-modal" class="fixed inset-0 bg-black/50 modal-backdrop flex items-center justify-center p-4 z-50 hidden">
    <div class="w-full max-w-md bg-white rounded-2xl p-6 card-shadow transform transition-all">
      <h2 class="text-xl font-bold text-dark mb-4" id="play-times-modal-title">设置播放次数</h2>
      <p class="text-gray-500 text-sm mb-4">选择单词的播放次数（1-100次），播放完成后自动下一个</p>
      <div class="grid grid-cols-5 gap-2 mb-6">
        <button class="play-time-btn py-3 border rounded-lg hover:bg-primary/10 transition-all" data-times="1">1次</button>
        <button class="play-time-btn py-3 border rounded-lg hover:bg-primary/10 transition-all" data-times="2">2次</button>
        <button class="play-time-btn py-3 border rounded-lg hover:bg-primary/10 transition-all" data-times="3">3次</button>
        <button class="play-time-btn py-3 border rounded-lg hover:bg-primary/10 transition-all" data-times="5">5次</button>
        <button class="play-time-btn py-3 border rounded-lg hover:bg-primary/10 transition-all" data-times="10">10次</button>
      </div>
      <div class="flex gap-2 mb-4">
        <input 
          type="number" 
          id="custom-times" 
          min="1" 
          max="100" 
          placeholder="1-100之间的次数" 
          class="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
        >
        <button id="confirm-custom-times" class="bg-primary hover:bg-primary/90 text-white py-2 px-4 rounded-lg btn-hover">确认</button>
      </div>
      <div class="flex gap-3">
        <button id="cancel-play-times" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-4 rounded-xl btn-hover">取消</button>
        <button id="stop-play-btn" class="flex-1 bg-accent hover:bg-accent/90 text-white py-3 px-4 rounded-xl btn-hover hidden">
          <i class="fa fa-stop"></i>
          <span>停止播放</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    // 全局变量：TXT文件存放目录和清单文件路径（确保路径正确）
    const TXT_FOLDER = "asset/";
    const FILE_LIST_PATH = TXT_FOLDER + "file-list.txt";

    // 初始默认单词列表
    const DEFAULT_WORDS = [
      { english: "apple", phonetic: "/ˈæpl/", chinese: "苹果" },
      { english: "banana", phonetic: "/bəˈnɑːnə/", chinese: "香蕉" },
      { english: "computer", phonetic: "/kəmˈpjuːtə/", chinese: "电脑" },
      { english: "elephant", phonetic: "/ˈelɪfənt/", chinese: "大象" },
      { english: "friend", phonetic: "/frend/", chinese: "朋友" },
      { english: "guitar", phonetic: "/ɡɪˈtɑː(r)/", chinese: "吉他" },
      { english: "hospital", phonetic: "/ˈhɒspɪtl/", chinese: "医院" },
      { english: "internet", phonetic: "/ˈɪntənet/", chinese: "互联网" },
      { english: "jungle", phonetic: "/ˈdʒʌŋɡl/", chinese: "丛林" },
      { english: "kangaroo", phonetic: "/ˌkæŋɡəˈruː/", chinese: "袋鼠" }
    ];
    
    // 初始化数据
    function initVocabularyData() {
      const saved = localStorage.getItem('vocabularyData');
      if (saved) return JSON.parse(saved);
      return {
        lists: { "默认列表": DEFAULT_WORDS },
        currentList: "默认列表",
        defaultPlayTimes: 3,
        txtLists: [] // 新增：缓存TXT列表名称，避免重复异步请求
      };
    }
    
    // 保存数据到本地存储
    function saveVocabularyData() {
      localStorage.setItem('vocabularyData', JSON.stringify(vocabularyData));
      showSaveHint();
    }
    
    // 显示保存提示
    function showSaveHint() {
      const hint = document.getElementById('save-hint');
      hint.classList.remove('hidden');
      setTimeout(() => hint.classList.add('hidden'), 2000);
    }

    // 从清单文件读取所有TXT文件名（缓存结果到vocabularyData.txtLists）
    async function getTxtFileNames() {
      // 优先使用缓存，避免重复请求
      if (vocabularyData.txtLists.length > 0) return vocabularyData.txtLists;
      
      try {
        const response = await fetch(FILE_LIST_PATH);
        if (!response.ok) throw new Error("未找到file-list.txt");
        const text = await response.text();
        const txtNames = text.split('\n')
          .map(line => line.trim())
          .filter(line => line && !line.startsWith('#'));
        
        // 缓存结果
        vocabulary
